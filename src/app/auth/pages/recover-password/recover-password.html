<div class="container">
  <div class="card">
    <h1 class="title">Recuperar senha</h1>
    

    <div class="api-error" *ngIf="errorMsg">{{ errorMsg }}</div>

    <form *ngIf="step === 1" [formGroup]="requestForm" (ngSubmit)="request()">
      <div class="field">
        <label for="email">E-mail</label>
        <input id="email" name="email" type="email" formControlName="email" />

        <div class="error" *ngIf="emailField?.touched">
          <span *ngIf="emailField?.hasError('required')">Campo obrigatório</span>
          <span *ngIf="emailField?.hasError('email')">Email inválido</span>
        </div>
      </div>

      <button type="submit" [disabled]="loading">
        {{ loading ? 'Enviando...' : 'Enviar código' }}
      </button>

      <a class="back" routerLink="/login">Voltar</a>
    </form>

    
    <div *ngIf="step === 2" class="step2">
      <div class="info">
        <div><b>Código de teste:</b> 123456</div>
        <div><b>resetId:</b> {{ resetId }}</div>
        <div><b>Expira em:</b> {{ expiresInSec }}s</div>
        <div><b>Reenviar em:</b> {{ resendInSec }}s</div>
      </div>

      <form [formGroup]="confirmForm" (ngSubmit)="confirm()">
        <div class="field">
          <label for="code">Código</label>
          <input id="code" name="code" type="text" formControlName="code" />

          <div class="error" *ngIf="codeField?.touched">
            <span *ngIf="codeField?.hasError('required')">Campo obrigatório</span>
            <span *ngIf="codeField?.hasError('minlength')">Mínimo de 6 dígitos</span>
          </div>
        </div>

        <div class="field">
          <label for="password">Nova senha</label>
          <input id="password" name="password" type="password" formControlName="password" />

          <div class="error" *ngIf="passwordField?.touched">
            <span *ngIf="passwordField?.hasError('required')">Campo obrigatório</span>
            <span *ngIf="passwordField?.hasError('minlength')">Mínimo de 8 caracteres</span>
          </div>
        </div>

        <div class="field">
          <label for="confirm">Confirmar senha</label>
          <input id="confirm" name="confirm" type="password" formControlName="confirm" />
        </div>

        <button type="submit" [disabled]="loading">
          {{ loading ? 'Confirmando...' : 'Confirmar' }}
        </button>
      </form>

      <div class="actions">
        <button type="button" class="ghost" (click)="resend()" [disabled]="loading || resendInSec > 0">
          Reenviar código {{ resendInSec > 0 ? '(' + resendInSec + 's)' : '' }}
        </button>

        <button type="button" class="ghost" (click)="backToRequest()">
          Trocar email
        </button>
      </div>
    </div>
  </div>
</div>
